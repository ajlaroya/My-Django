{% extends "base.html" %}

{% load bulma_tags %}

{% block title %}<title>Plume - {{ profile.user }}'s profile</title>{% endblock %}

{% block content %}
<div class="section">

  {% if profile.user %}
  <h1 class="title has-text-light">{{ profile.user }} profile</h1>

  <!-- Followers -->
  <div class="mb-3">
    <p><a href="{% url 'accounts:followers-list' profile.pk%}" class="has-text-warning">Followers: {{ follower_count }}</a></p>
    {% if user == request.user %}
    {% else %}
    {% if request.user.is_authenticated %}
    {% if is_following %}
    <p><em>You are following {{ user }}</em></p>
    <form method="POST" action="{% url 'accounts:remove-follower' profile.pk %}">
      {% csrf_token %}
      <button class="button" type=submit>Unfollow</button>
    </form>
    {% else %}
    <form method="POST" action="{% url 'accounts:add-follower' profile.pk %}">
      {% csrf_token %}
      <button class="button" type=submit>Follow</button>
    </form>
    {% endif %}
    {% endif %}
    {% endif %}
  </div>

  <span>
    {% if request.user.is_authenticated %}
    {% if profile.user == request.user %}
    <a href="{% url 'accounts:profile-edit' profile.pk %}" class="has-text-warning">Edit profile</a>
    {% endif %}
    {% endif %}
  </span>
  {% endif %}
  <div class="row justify-content-center mt-5">
    <div class="card p-5 column is-one-third">
      <figure class="image is-128x128">
        <img src="{{ profile.picture.url }}" class="is-rounded"/>
      </figure>
      {% if profile.user %}
      <h2 class="is-size-5 py-4 has-text-warning">@{{ profile.user }}</h2>
        {% endif %}
        <div>
          {% if profile.location %}
          <p>location: {{ profile.location }}</p>
          {% endif %}
          {% if profile.bio %}
          <p>bio: {{ profile.bio }}</p>
          {% endif %}
        </div>
      </div>
    </div>

    <span class="is-size-4">Post history</span>
    {% for post in posts %}
    <div class="row mt-5">
      <p><strong><a href="{% url 'accounts:profile' post.author.profile.pk %}" class="has-text-warning">@{{ post.author }}</a></strong> {{ post.created_at }}</p>
      {% if post.image %}
      <img src="{{ post.image.url }}" class="image post-image"/>
      {% endif %}
      <p>{{ post.message }}</p>
      <a class="stretched-link" href="{% url 'posts:single' username=post.author pk=post.pk %}"></a>
    </div>
    {% endfor %}
  </div>
  {% endblock %}
